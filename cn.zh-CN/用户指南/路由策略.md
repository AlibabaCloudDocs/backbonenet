# 路由策略 {#concept_994907 .concept}

云企业网支持路由策略功能。通过路由策略功能，您不仅可以过滤路由信息，还可以修改路由属性，帮助您自定义管理云上网络互通能力。

## 功能简介 {#section_g3p_9s8_f5s .section}

您可以在各地域的云企业网实例上配置路由策略节点（以下简称节点），每个地域可以在RegionIn和RegionOut两个方向分别配置一个或多个节点，每个节点是条件语句和执行语句的集合，节点按照优先级从小到大排列。执行路由策略时，系统从优先级数字最小的节点开始匹配条件语句。路由策略按照匹配规则允许或拒绝通过被匹配的路由，允许通过的路由，支持修改路由属性。

![路由策略](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/803311/156333449851040_zh-CN.png)

## 策略组成元素 {#section_6rr_6rj_3pj .section}

路由策略由策略基本信息、匹配条件和执行动作组成。

**说明：** 仅策略行为设置为允许才支持设置执行动作，策略行为设置为拒绝不支持设置执行动作。

-   策略基本信息由以下元素组成。

    |元素|说明|
    |--|--|
    |**策略优先级**|路由策略节点的优先级。 优先级数字越小，优先级越高。 同地域同策略生效方向的节点优先级唯一。执行路由策略时，系统从优先级数字最小的节点开始匹配条件语句，因此在指定节点的优先级时，要注意符合期望的匹配顺序。

 |
    |**策略描述**|路由策略的描述信息。|
    |**策略应用地域**|路由策略应用的地域。|
    |**策略应用方向**|路由策略应用的方向。     -   RegionIn：流出地域节点的方向。
    -   RegionOut：流入地域节点的方向。
 |
    |**策略行为**|所有匹配条件通过后的策略行为。支持以下行为：     -   允许：允许通过被匹配的路由。
    -   拒绝：拒绝通过被匹配的路由。
 |
    |**关联策略优先级**|关联的下一个路由策略节点的优先级。|

-   匹配条件由以下元素组成。

    |元素|说明|
    |--|--|
    |**地域**|匹配路由的地域，仅支持匹配源地域。|
    |**实例类型**|匹配路由的实例类型。支持匹配以下实例类型：     -   源实例类型。
    -   目的实例类型。
    -   源和目的实例类型。
 |
    |**实例ID列表**|匹配路由的实例ID列表。支持匹配以下实例ID列表：     -   源实例ID列表。
    -   目的实例ID列表。
    -   源和目的实例ID列表。
 |
    |**路由表**|匹配路由的路由表。支持匹配以下路由表：     -   源路由表。
    -   目的路由表。
    -   源和目的路由表。
 |
    |**路由类型**|匹配路由的路由类型。支持匹配以下路由类型：     -   系统路由。
    -   用户路由。
    -   BGP路由。
 |
    |**路由前缀**|匹配路由前缀。支持以下匹配模式：     -   模糊匹配。
    -   精确匹配。
 |
    |**AS Path**|匹配路由的AS Path。支持以下匹配模式：     -   模糊匹配。
    -   精确匹配。
 **说明：** AS Path是公认强制属性，描述了一条BGP路由在传递过程中所经过的AS的号码。

 |
    |**Community**|匹配路由的Community。支持以下匹配模式：     -   模糊匹配。
    -   精确匹配。
 **说明：** Community是可选传递属性，可以针对特定的路由设置特定的Community属性值，下游路由器在执行路由策略时，可以通过Community属性值来匹配目标路由。

 |

-   执行动作由以下元素组成。

    |元素|说明|
    |--|--|
    |**Community**|设置Community属性值。支持以下设置模式：     -   添加。
    -   替换。
 |
    |**路由优先级**|设置允许通过的路由的优先级。|


## 策略匹配流程 {#section_h1g_wng_q7s .section}

路由策略采用match-action模式，即先匹配条件后执行动作。执行路由策略时，从优先级数字最小的节点开始匹配条件语句。

-   如果被匹配的路由满足节点中的所有匹配条件，则判断策略行为。
    -   策略行为是允许：执行该节点中的执行语句并允许通过被匹配的路由，被匹配的路由不会再继续匹配下一个节点。
    -   策略行为是拒绝：拒绝通过被匹配的路由，被匹配的路由不会再继续匹配下一个节点，匹配过程立即结束。
-   如果被匹配的路由与节点中有任何一个匹配条件不匹配 ，则被匹配的路由继续匹配下一个节点。
-   如果被匹配的路由满足下一个节点中的所有匹配条件，则判断策略行为。
    -   策略行为是允许：执行该节点中的执行语句并允许通过被匹配的路由，被匹配的路由不会再继续匹配下一个节点。
    -   策略行为是拒绝：拒绝通过被匹配的路由，被匹配的路由不会再继续匹配下一个节点，匹配过程立即结束。
-   如果被匹配的路由与节点中有任何一个匹配条件不匹配 ，则被匹配的路由继续匹配下一个节点，以此类推。
-   如果被匹配的路由匹配至最后一个节点，仍与该节点中有任何一个匹配条件不匹配 ，则允许通过被匹配的路由。

![路由策略匹配流程](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/803311/156333449951016_zh-CN.png)

## 使用场景 {#section_z3z_9s4_00y .section}

路由策略具有如下使用场景。

-   管控VPC与VPC/VBR/CCN间的互通能力

    默认情况下，云企业网采取VPC与VPC/VBR/CCN间互通的策略，但在特定场景下，您可能需要阻断VPC与VPC/VBR/CCN间的互通能力，如下图。

    ![管控VPC与VPC/VBR/CCN间的互通能力 ](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/803311/156333449951086_zh-CN.png)

    您可以使用路由策略功能阻断VPC1与VPC2间的互通能力，但VPC1与CCN1/VBR1正常互通，VPC2与CCN1/VBR1也正常互通。

-   管控VBR与VPC/VBR/CCN间的互通能力

    默认情况下，加载到云企业网中的VBR与其他加载到云企业网中的CCN/VBR不互通，但在特定场景下，您可能需要允许VBR与CCN/VBR间互通，如下图。

    ![管控VBR与VPC/VBR/CCN间的互通能力](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/803311/156333449951104_zh-CN.png)

    您可以使用路由策略功能允许VBR1与VBR2间互通，但VBR1与CCN1不能互通，VBR2与CCN1也不能互通。

-   管控CCN与VPC/VBR/CCN间的互通能力

    默认情况下，加载到云企业网中的CCN与其他加载到云企业网中的CCN/VBR不互通，但在特定场景下，您可能需要允许CCN与CCN/VBR间互通，如下图。

    ![管控CCN与VPC/VBR/CCN间的互通能力](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/803311/156333449951135_zh-CN.png)

    您可以使用路由策略功能允许CCN1与CCN2间互通，但CCN1与VBR1不能互通，CCN2与VBR1也不能互通。


## 相关文档 {#section_f4u_x3b_mkj .section}

[CreateCenRouteMap](../../../../cn.zh-CN/.md#)

[DescribeCenRouteMaps](../../../../cn.zh-CN/.md#)

[ModifyCenRouteMap](../../../../cn.zh-CN/.md#)

[DeleteCenRouteMap](../../../../cn.zh-CN/.md#)


# 路由策略概述 {#concept_994907 .concept}

云企业网支持路由策略功能。通过路由策略功能，您不仅可以过滤路由信息，还可以修改路由属性，帮助您自定义管理云上网络互通能力。

**说明：** 目前，路由策略功能白名单开放，如需使用，请[提交工单](https://workorder-intl.console.aliyun.com/?spm=5176.11182188.console-base-top.dworkorder.18ae48822ifKdZ#/ticket/createIndex)。

## 功能简介 {#section_g3p_9s8_f5s .section}

一个云企业网实例在各个地域都有一个云企业网地域网关，云企业网地域网关是加载到云企业网中网络实例（VPC、VBR、CCN）互联的基础。路由可以在入地域网关（RegionIn）和出地域网关（RegionOut）两个方向传递，通过各个云企业网地域网关传递给同地域网络实例或跨地域网络实例。

![路由策略](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/803311/156871075551040_zh-CN.png)

您可以在云企业网的各个地域网关配置路由策略，每个地域网关支持在入地域网关和出地域网关两个方向分别配置路由策略，每条路由策略是条件语句和执行语句的集合。路由策略按照优先级从小到大排列。执行路由策略时，系统从优先级数字最小的路由策略开始匹配条件语句。路由策略按照匹配规则允许或拒绝通过被匹配的路由，允许通过的路由支持修改路由属性。

## 策略组成元素 {#section_6rr_6rj_3pj .section}

路由策略由策略基本信息、匹配条件和执行动作组成。

**说明：** 仅策略行为设置为允许才支持设置执行动作，策略行为设置为拒绝不支持设置执行动作。

-   策略基本信息由以下元素组成。

    |元素|说明|
    |--|--|
    |**策略优先级**|路由策略的优先级。 优先级数字越小，优先级越高。 同地域同策略应用方向的路由策略优先级唯一。执行路由策略时，系统从优先级数字最小的路由策略开始匹配条件语句，因此在指定路由策略优先级时，要注意符合期望的匹配顺序。

 |
    |**策略描述**|路由策略的描述信息。|
    |**策略应用地域**|路由策略应用的地域。|
    |**策略应用方向**|路由策略应用的方向。     -   入地域网关方向：路由传入云企业网地域网关的方向。例如：路由从本地域网络实例发布到本地域网关，或其他地域的路由发布到本地域网关。
    -   出地域网关方向：路由传出云企业网地域网关的方向。例如：路由从本地域网关发布到本地域下其他网络实例，或发布到其他地域网关。
 |
    |**策略行为**|所有匹配条件通过后的策略行为。支持以下行为：     -   允许：允许通过被匹配的路由。
    -   拒绝：拒绝通过被匹配的路由。
 |
    |**关联优先级**|关联的下一条路由策略的优先级，为可选项，取值：1~100。     -   当未配置关联优先级时，路由策略无关联的下一条路由策略。
    -   当关联优先级取值为1时，路由策略关联当前路由策略的下一条路由策略。
    -   当关联优先级取值非1时，路由策略关联优先级必须大于当前路由策略的优先级。
 当策略行为是允许时，匹配通过的路由才会继续匹配关联优先级的路由策略。

 |

-   匹配条件由以下元素组成。

    |元素|说明|
    |--|--|
    |**地域**|匹配路由的地域，仅支持匹配路由的源地域。|
    |**实例类型**|匹配路由的实例类型。支持匹配以下实例类型：     -   源实例类型。
    -   目的实例类型 。

**说明：** 目的实例类型仅策略应用方向为出地域网关方向且目的实例类型为本地域下实例类型时有效。

 |
    |**实例ID列表**|匹配路由的实例ID列表。支持匹配以下实例ID列表：     -   源实例ID列表。
    -   目的实例ID列表。

**说明：** 目的实例ID列表仅策略应用方向为出地域网关方向且目的实例ID为本地域下实例ID时有效。

 实例ID列表支持排除匹配模式，即匹配路由的实例ID不在匹配条件中的实例ID列表范围内表示匹配成功，否则匹配失败。

 |
    |**路由表**|匹配路由的路由表。支持匹配以下路由表：     -   源路由表。
    -   目的路由表。

**说明：** 目的路由表仅策略应用方向为出地域网关方向且目的路由表为本地域下路由表时有效。

 |
    |**路由类型**|匹配路由的路由类型。支持匹配以下路由类型：     -   系统路由：系统自动生成的路由。
    -   用户路由：用户手动添加的自定义路由。
    -   BGP路由：通告至BGP中的路由。
 |
    |**路由前缀**|匹配路由前缀。支持以下匹配模式：     -   模糊匹配：匹配条件中的路由前缀包含被匹配路由的路由前缀即判定为匹配成功。

例如：定义1.1.0.0/16的策略可以模糊匹配到1.1.1.0/24的路由。

    -   精确匹配：匹配条件中的路由前缀必须与被匹配路由的路由前缀一致，才判定为匹配成功。

例如：定义1.1.0.0/16的策略仅可以精确匹配到1.1.0.0/16的路由。

 |
    |**AS Path**|匹配路由的AS Path。支持以下匹配模式：     -   模糊匹配：匹配条件中的AS Path与被匹配路由的AS Path有重叠即判定为匹配成功。

例如：匹配条件为\[65001，65002\]的AS Path规则可以模糊匹配到AS Path为\[65501，65001\]的路由。

    -   精确匹配：匹配条件中的AS Path必须与被匹配路由的AS Path一致，才判定为匹配成功。

例如：匹配条件为\[65501，65001，60011\]的AS Path规则仅可以精确匹配到AS Path为\[65501，65001，60011\]的路由。

 **说明：** AS Path是公认强制属性，描述了一条BGP路由在传递过程中所经过的AS的号码。

 |
    |**Community**|匹配路由的Community。支持以下匹配模式：     -   模糊匹配：匹配条件中的Community与被匹配路由的Community有重叠即判定为匹配成功。

例如：匹配条件为\[65001:1000，65002:2000\]的Community规则可以模糊匹配到Community为\[65501:1000，65001:1000\]的路由。

    -   精确匹配：匹配条件中的Community必须与被匹配路由的Community一致，才判定为匹配成功。

例如：匹配条件为\[65001:65001，65002:65005，65003:65001\]的Community规则仅可以精确匹配到Community为\[65001:65001，65002:65005，65003:65001\]的路由。

 **说明：** Community是可选传递属性，可以针对特定的路由设置特定的Community属性值，下游路由器在执行路由策略时，可以通过Community属性值来匹配目标路由。

 |

-   执行动作由以下元素组成。

    |元素|说明|
    |--|--|
    |**Community**|设置Community属性值。支持以下设置模式：     -   添加。
    -   替换。
 |
    |**路由优先级**|设置允许通过的路由的优先级。|


## 策略匹配流程 {#section_h1g_wng_q7s .section}

路由策略采用match-action模式，即先匹配条件后执行动作。执行路由策略时，从优先级数字最小的路由策略开始匹配条件语句。

-   如果被匹配的路由满足路由策略中的所有匹配条件，则判断策略行为。
    -   策略行为是允许：执行该路由策略中的执行语句并允许通过被匹配的路由，被匹配的路由默认不会再继续匹配下一条路由策略，但如果配置了关联优先级，则需要继续匹配关联优先级的路由策略。
    -   策略行为是拒绝：拒绝通过被匹配的路由，被匹配的路由默认不会再继续匹配下一条路由策略，匹配过程立即结束。
-   如果被匹配的路由与路由策略中有任何一个匹配条件不匹配 ，则被匹配的路由继续匹配下一条路由策略。
-   如果被匹配的路由满足下一条路由策略中的所有匹配条件，则判断策略行为。
    -   策略行为是允许：执行该路由策略中的执行语句并允许通过被匹配的路由，被匹配的路由默认不会再继续匹配下一条路由策略，但如果配置了关联优先级，则需要继续匹配关联优先级的路由策略。
    -   策略行为是拒绝：拒绝通过被匹配的路由，被匹配的路由默认不会再继续匹配下一条路由策略，匹配过程立即结束。
-   如果被匹配的路由与路由策略中有任何一个匹配条件不匹配 ，则被匹配的路由继续匹配下一条路由策略，以此类推。
-   如果被匹配的路由匹配至最后一条路由策略，仍与该路由策略中有任何一个匹配条件不匹配 ，则允许通过被匹配的路由。

![路由策略匹配流程](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/803311/156871075551016_zh-CN.png)

## 使用场景 {#section_z3z_9s4_00y .section}

路由策略具有如下使用场景。

-   管控VPC与VPC/VBR/CCN间的互通能力

    默认情况下，云企业网采取VPC与VPC/VBR/CCN间互通的策略，但在特定场景下，您可能需要阻断VPC与VPC/VBR/CCN间的互通能力，如下图。

    ![管控VPC与VPC/VBR/CCN间的互通能力 ](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/803311/156871075551086_zh-CN.png)

    您可以使用路由策略功能阻断VPC1与VPC2间的互通能力，但VPC1与CCN1/VBR1正常互通，VPC2与CCN1/VBR1也正常互通。

-   管控VBR与VPC/VBR/CCN间的互通能力

    默认情况下，加载到云企业网中的VBR与其它加载到云企业网中的CCN/VBR不互通，但在特定场景下，您可能需要允许VBR与CCN/VBR间互通，如下图。

    ![管控VBR与VPC/VBR/CCN间的互通能力](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/803311/156871075551104_zh-CN.png)

    您可以使用路由策略功能允许VBR1与VBR2间互通，但VBR1与CCN1不能互通，VBR2与CCN1也不能互通。

-   管控CCN与VPC/VBR/CCN间的互通能力

    默认情况下，加载到云企业网中的CCN与其它加载到云企业网中的CCN/VBR不互通，但在特定场景下，您可能需要允许CCN与CCN/VBR间互通，如下图。

    ![管控CCN与VPC/VBR/CCN间的互通能力](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/803311/156871075551135_zh-CN.png)

    您可以使用路由策略功能允许CCN1与CCN2间互通，但CCN1与VBR1不能互通，CCN2与VBR1也不能互通。


## 使用限制 {#section_jf7_of5_x4z .section}

使用路由策略功能前，请了解以下限制。

|资源|默认限制|提升配额|
|--|----|----|
|每个地域网关支持创建的入地域网关方向路由策略的数量|100|无法调整|
|每个地域网关支持创建的出地域网关方向路由策略的数量|100|无法调整|

## 相关文档 {#section_f4u_x3b_mkj .section}

[添加路由策略](intl.zh-CN/用户指南/路由策略/添加路由策略.md#)

[修改路由策略](intl.zh-CN/用户指南/路由策略/修改路由策略.md#)

[删除路由策略](intl.zh-CN/用户指南/路由策略/删除路由策略.md#)

[路由策略API](../../../../intl.zh-CN/API参考/API概览.md#section_zax_pco_bki)

